<html>
  <head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/jquery-ui.min.js"></script>
    <script type="text/javascript" src="http://worldofbears.net:2974/static/hookbox.js"></script>
  </head>
  <body>
    <script type="text/javascript">
      window.onload = function() {
      var conn = hookbox.connect('http://worldofbears.net:2974');
      conn.onError = function(err) { alert("connection failed: " + err.msg); };

      var subscription = null;
      conn.onSubscribed = function(channelName, _subscription) {
        subscription = _subscription;
        foo = subscription;
        subscription.onPublish = function(frame) {
          id = frame.payload[0];
          pos = frame.payload[1];
          $("#"+id).offset(pos);
        };
      };
      conn.subscribe("chan1");
      var pushPos = function(ev, ui) {
        pos = ui.offset;
        id = $(ui.helper).attr("id");
        data = [id, pos];
        conn.publish("chan1", data);
      };
      $(".drag").draggable({stop: pushPos});
      }
    </script>

    <div id="div1" class="drag">Drag me!</div>
    <div id="div2" class="drag">Or drag me</div>
  </body>
</html>
